<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Navigation</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-color: #00f2ff;
            --neon-pink: #ff007a;
            --neon-green: #39ff14;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #050505;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            margin: 0;
            position: fixed;
        }

        .bg-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 30%, #1a1033 0%, #050505 50%);
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            animation: float 15s infinite alternate ease-in-out;
        }

        .orb-1 { width: 300px; height: 300px; background: var(--neon-color); top: -80px; right: -40px; }
        .orb-2 { width: 250px; height: 250px; background: var(--neon-pink); bottom: -60px; left: -40px; animation-delay: -3s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, 50px) scale(1.1); }
        }

        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å–∞ */
        .status-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #444;
            transition: all 0.5s ease;
        }

        .status-dot.online {
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
            animation: pulse-green 2s infinite;
        }

        .status-dot.offline {
            animation: pulse-gray 2s infinite;
        }

        @keyframes pulse-green {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }

        @keyframes pulse-gray {
            0% { opacity: 0.5; }
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 24px 20px calc(40px + env(safe-area-inset-bottom));
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
        }

        .page::-webkit-scrollbar { width: 0px; }

        .hidden-left { transform: translateX(-100%); opacity: 0; pointer-events: none; }
        .hidden-right { transform: translateX(100%); opacity: 0; pointer-events: none; }
        .hidden-bottom { transform: translateY(100%); opacity: 0; pointer-events: none; }
        .active { transform: translateX(0); opacity: 1; pointer-events: all; }
        .active-modal { transform: translateY(0); opacity: 1; pointer-events: all; }

        .glass-card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 22px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            position: relative;
        }

        .glass-card:active {
            transform: scale(0.94);
            border-color: rgba(0, 242, 255, 0.5);
            background: rgba(255, 255, 255, 0.08);
        }

        /* –°—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∫–∏ */
        .admin-card {
            background: rgba(10, 10, 15, 0.8);
            border: 1px solid rgba(0, 242, 255, 0.15);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .admin-section-title {
            font-size: 12px;
            font-weight: 700;
            letter-spacing: 0.1em;
            text-transform: uppercase;
            color: var(--neon-color);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-section-title::after {
            content: '';
            height: 1px;
            flex: 1;
            background: linear-gradient(90deg, rgba(0, 242, 255, 0.3), transparent);
        }

        .guide-item-admin {
            background: rgba(255, 255, 255, 0.03);
            border-left: 2px solid var(--neon-pink);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            position: relative;
        }

        .admin-input {
            width: 100%;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 10px 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 13px;
            transition: border-color 0.3s;
        }

        .admin-input:focus {
            outline: none;
            border-color: var(--neon-color);
            background: rgba(0, 242, 255, 0.05);
        }

        .admin-label {
            font-size: 10px;
            color: #777;
            margin-bottom: 4px;
            margin-left: 4px;
            display: block;
            text-transform: uppercase;
        }

        .admin-select {
            width: 100%;
            background: rgba(0,0,0,0.6);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 10px 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .btn-delete-icon {
            color: rgba(255, 77, 77, 0.6);
            transition: color 0.3s;
            padding: 4px;
        }

        .btn-delete-icon:hover {
            color: #ff4d4d;
        }

        .btn-add-cyber {
            background: rgba(0, 242, 255, 0.05);
            color: var(--neon-color);
            border: 1px dashed rgba(0, 242, 255, 0.4);
            border-radius: 12px;
            padding: 12px;
            width: 100%;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }

        .btn-add-cyber:active {
            background: rgba(0, 242, 255, 0.15);
            transform: scale(0.98);
        }

        .btn-save-cyber {
            background: linear-gradient(135deg, #0066ff, #00f2ff);
            box-shadow: 0 4px 15px rgba(0, 242, 255, 0.3);
            color: white;
            font-weight: 700;
            padding: 14px;
            border-radius: 15px;
            width: 100%;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .btn-edit-list {
            background: rgba(255, 0, 122, 0.1);
            color: var(--neon-pink);
            border: 1px solid rgba(255, 0, 122, 0.3);
            border-radius: 10px;
            padding: 8px;
            width: 100%;
            font-size: 12px;
            margin-top: 5px;
        }

        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .icon-box {
            width: 54px;
            height: 54px;
            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 4px 4px 12px rgba(0,0,0,0.3);
            margin-right: 18px;
            flex-shrink: 0;
        }

        .icon-box svg { width: 26px; height: 26px; }

        .title-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #a1a1a1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .badge-dev {
            font-size: 10px;
            padding: 2px 8px;
            border-radius: 10px;
            background: rgba(255, 0, 122, 0.15);
            color: #ff007a;
            border: 1px solid rgba(255, 0, 122, 0.3);
            display: inline-block;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div class="bg-glow">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–≤—è–∑–∏ -->
    <div class="status-container">
        <div id="status-dot" class="status-dot offline"></div>
    </div>

    <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
    <div id="main-page" class="page active">
        <header class="mb-10 mt-4 text-center">
            <h1 id="nav-header" class="text-3xl font-bold title-gradient tracking-tight select-none">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h1>
            <p id="nav-subheader" class="text-gray-500 text-sm mt-2">–¢–≤–æ–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É</p>
        </header>

        <div id="main-menu-container" class="grid gap-4">
            <!-- –ö–Ω–æ–ø–∫–∏ —Ä–µ–Ω–¥–µ—Ä—è—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
        </div>

        <footer class="mt-auto pt-16 pb-8 text-center">
            <p class="text-[10px] text-gray-600 opacity-50">Developed by Elena Sotnikova</p>
        </footer>
    </div>

    <!-- –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–ê–Ø –í–ù–£–¢–†–ï–ù–ù–Ø–Ø –°–¢–†–ê–ù–ò–¶–ê -->
    <div id="sub-page" class="page hidden-right">
        <header class="mb-10 mt-4 text-center">
            <h1 id="sub-page-title" class="text-3xl font-bold title-gradient tracking-tight text-blue-400">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h1>
            <p id="sub-page-subtitle" class="text-gray-500 text-sm mt-2">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</p>
        </header>
        <div id="sub-page-container" class="grid gap-4"></div>
        <div class="mt-auto h-20"></div> 
    </div>

    <!-- –≠–ö–†–ê–ù –ê–î–ú–ò–ù–ö–ò -->
    <div id="admin-page" class="page hidden-bottom" style="background: rgba(5,5,8,0.98); z-index: 50;">
        <header class="mb-8 flex justify-between items-center sticky top-0 bg-[#050508] py-4 z-10">
            <div>
                <h2 class="text-2xl font-bold text-white tracking-tight">Terminal</h2>
                <div class="text-[10px] text-cyan-400 font-mono">ACCESS GRANTED // ADMIN_MODE</div>
            </div>
            <button onclick="closeAdmin()" class="bg-white/5 w-10 h-10 rounded-full flex items-center justify-center text-gray-400">‚úï</button>
        </header>

        <div id="admin-content-main">
            <!-- –°–µ–∫—Ü–∏—è: –ó–∞–≥–æ–ª–æ–≤–∫–∏ -->
            <div class="admin-card">
                <div class="admin-section-title">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>
                    –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ì–ª–∞–≤–Ω–æ–π
                </div>
                <div class="mb-2">
                    <label class="admin-label">–ì–ª–∞–≤–Ω—ã–π –∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" id="admin-header-title" class="admin-input">
                </div>
                <div>
                    <label class="admin-label">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                    <input type="text" id="admin-header-subtitle" class="admin-input">
                </div>
            </div>

            <!-- –°–µ–∫—Ü–∏—è: –ö–Ω–æ–ø–∫–∏ –≥–ª–∞–≤–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ -->
            <div class="admin-card">
                <div class="admin-section-title">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
                    –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ–Ω—é
                </div>
                <div id="admin-main-menu-list" class="space-y-4"></div>
                <button onclick="addNewMainMenuButton()" class="btn-add-cyber mt-4">
                    <span>+</span> –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É
                </button>
            </div>

            <button onclick="saveAdminData()" class="btn-save-cyber">
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
            </button>
        </div>

        <!-- –°–µ–∫—Ü–∏—è: –†–µ–¥–∞–∫—Ç–æ—Ä –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–ø–∏—Å–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Å–∫—Ä—ã—Ç–∞) -->
        <div id="admin-content-sublist" class="hidden">
            <button onclick="backToMainAdmin()" class="text-gray-400 text-xs mb-4 flex items-center gap-2">
                ‚Äπ –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–Ω–æ–º—É –º–µ–Ω—é
            </button>
            <div class="admin-card">
                <div class="admin-section-title text-pink-500" id="admin-sublist-title">
                    –†–µ–¥–∞–∫—Ç–æ—Ä —Å–ø–∏—Å–∫–∞
                </div>
                <div id="admin-sublist-items" class="space-y-4"></div>
                <button onclick="addNewSubItem()" class="btn-add-cyber mt-4">
                    <span>+</span> –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç –≤ —Å–ø–∏—Å–æ–∫
                </button>
            </div>
            <button onclick="saveSubList()" class="btn-save-cyber">
                –ì–æ—Ç–æ–≤–æ (–≤–µ—Ä–Ω—É—Ç—å—Å—è)
            </button>
        </div>

        <div id="save-status" class="text-center text-xs text-cyan-400 mt-4 opacity-0 transition-opacity font-mono">DATABASE_SYNC_COMPLETE...</div>
        <div class="h-24"></div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø ---
        const ADMIN_ID = 758556732; 
        const ADMIN_PASSWORD = "cyber_admin_secure_99"; 

        // --- FIREBASE SETUP ---
        const firebaseConfig = {
            apiKey: "AIzaSyCiYBslwEecbyuMyW5J05nvTs_sXLlurR4",
            authDomain: "tg-menu.firebaseapp.com",
            projectId: "tg-menu",
            storageBucket: "tg-menu.firebasestorage.app",
            messagingSenderId: "754545603793",
            appId: "1:754545603793:web:a466fd9b21a298a69d41f0"
        };

        const configDocId = "main_nav_v4_pro"; // –ù–æ–≤–∞—è –≤–µ—Ä—Å–∏—è –ë–î –¥–ª—è –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
        let db, auth;
        let isOnline = false;

        // --- –ù–û–í–ê–Ø –°–¢–†–£–ö–¢–£–†–ê –î–ê–ù–ù–´–• (PRO) ---
        const defaultData = {
            headerTitle: "–ù–∞–≤–∏–≥–∞—Ü–∏—è",
            headerSubtitle: "–¢–≤–æ–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É",
            mainMenu: [
                {
                    id: "guides",
                    title: "–í—Å–µ –≥–∞–π–¥—ã",
                    subtitle: "–°–æ–±—Ä–∞–Ω–æ —Å–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ",
                    iconContent: '<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>',
                    iconColor: "text-blue-400",
                    mode: "list", // –¢–∏–ø: –°–ø–∏—Å–æ–∫
                    items: [
                        { title: '–¢–æ–ø-10 —Å–µ–∫—Ä–µ—Ç–æ–≤ —É—Å–ø–µ—Ö–∞', link: 'https://t.me/your_link_guide1', icon: 'üî•' },
                        { title: '–ö–∞–∫ –≤—ã—Ä–∞—Å—Ç–∏ –≤ –¥–æ—Ö–æ–¥–µ', link: 'https://t.me/your_link_guide2', icon: 'üìà' },
                        { title: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —ç–∫—Å–ø–µ—Ä—Ç–∞', link: 'https://t.me/your_link_guide3', icon: 'üõ†' },
                        { title: '–ì–∞–π–¥ –ø–æ Reels', link: 'https://t.me/your_link_guide4', icon: 'üé¨' }
                    ]
                },
                {
                    id: "service",
                    title: "–ú–æ–∏ —É—Å–ª—É–≥–∏",
                    subtitle: "–õ—É—á—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–¥–µ—Å—å",
                    iconContent: '<polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>',
                    iconColor: "text-cyan-400",
                    border: "1px solid rgba(0, 242, 255, 0.2)",
                    mode: "link", // –¢–∏–ø: –°—Å—ã–ª–∫–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
                    directLink: "https://t.me/your_link_2",
                    items: [] // –ü—É—Å—Ç–æ–π —Å–ø–∏—Å–æ–∫ –Ω–∞ —Å–ª—É—á–∞–π —Å–º–µ–Ω—ã —Ä–µ–∂–∏–º–∞
                },
                {
                    id: "dev",
                    title: "–û–±—É—á–µ–Ω–∏–µ",
                    subtitle: "–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ...",
                    isBadge: true,
                    iconContent: '<path d="M22 10v6M2 10l10-5 10 5-10 5z"></path><path d="M6 12v5c3 3 9 3 12 0v-5"></path>',
                    iconColor: "text-purple-400",
                    mode: "link",
                    directLink: "action:warning",
                    items: []
                },
                {
                    id: "contact",
                    title: "–°–≤—è–∑—å —Å–æ –º–Ω–æ–π",
                    subtitle: "–û—Ç–≤–µ—á–∞—é –ª–∏—á–Ω–æ",
                    iconContent: '<path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path>',
                    iconColor: "text-green-400",
                    mode: "link",
                    directLink: "https://t.me/your_username",
                    items: []
                },
                {
                    id: "reviews",
                    title: "–û—Ç–∑—ã–≤—ã",
                    subtitle: "–ß—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –ø–æ–¥–ø–∏—Å—á–∏–∫–∏",
                    iconContent: '<path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"></path>',
                    iconColor: "text-pink-500",
                    border: "1px solid rgba(255, 0, 122, 0.2)",
                    mode: "link",
                    directLink: "https://t.me/your_link_5",
                    items: []
                }
            ]
        };

        let appData = JSON.parse(JSON.stringify(defaultData));

        async function initApp() {
            try {
                const app = firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                await auth.signInAnonymously();
                
                const docRef = db.collection('configs').doc(configDocId);
                docRef.onSnapshot((doc) => {
                    if (doc.exists) {
                        const data = doc.data();
                        
                        // –ú–∏–≥—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö (–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
                        appData = {
                            headerTitle: data.headerTitle || defaultData.headerTitle,
                            headerSubtitle: data.headerSubtitle || defaultData.headerSubtitle,
                            mainMenu: (data.mainMenu || defaultData.mainMenu).map(item => ({
                                ...item,
                                items: item.items || [] // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º –Ω–∞–ª–∏—á–∏–µ –º–∞—Å—Å–∏–≤–∞ items
                            }))
                        };
                        
                        updateUI();
                        setOnlineStatus(true);
                    } else {
                        docRef.set(appData);
                        updateUI();
                        setOnlineStatus(true);
                    }
                }, (error) => {
                    console.error("Firebase error:", error);
                    setOnlineStatus(false);
                    updateUI(); 
                });
            } catch (e) {
                console.error("Init error:", e);
                setOnlineStatus(false);
                updateUI();
            }
        }

        function setOnlineStatus(online) {
            isOnline = online;
            const dot = document.getElementById('status-dot');
            if (dot) dot.className = `status-dot ${online ? 'online' : 'offline'}`;
        }

        function updateUI() {
            document.getElementById('nav-header').textContent = appData.headerTitle;
            document.getElementById('nav-subheader').textContent = appData.headerSubtitle;
            renderMainMenu();
        }

        function renderMainMenu() {
            const container = document.getElementById('main-menu-container');
            if (!container) return;
            container.innerHTML = '';
            
            (appData.mainMenu || []).forEach((btn) => {
                const btnEl = document.createElement('div');
                btnEl.className = 'glass-card p-4 flex items-center cursor-pointer';
                
                btnEl.onclick = () => handleMainButtonClick(btn);

                const iconStyle = btn.border ? `border: ${btn.border}` : '';
                const subtitleHtml = btn.isBadge 
                    ? `<div class="badge-dev">${btn.subtitle}</div>` 
                    : `<p class="text-gray-400 text-xs text-white/60">${btn.subtitle}</p>`;

                btnEl.innerHTML = `
                    <div class="icon-box" style="${iconStyle}">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="${btn.iconColor || 'text-white'}">
                            ${btn.iconContent}
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-white">${btn.title}</h3>
                        ${subtitleHtml}
                    </div>
                    <div class="opacity-30 text-xl">‚Ä∫</div>
                `;
                container.appendChild(btnEl);
            });
        }

        // –õ–æ–≥–∏–∫–∞ –∫–ª–∏–∫–∞ –ø–æ –≥–ª–∞–≤–Ω–æ–π –∫–Ω–æ–ø–∫–µ
        function handleMainButtonClick(btn) {
            if (btn.directLink === 'action:warning') {
                tg.HapticFeedback.notificationOccurred('warning');
                return;
            }

            if (btn.mode === 'list') {
                openSubPage(btn);
            } else {
                handleLink(btn.directLink);
            }
        }

        // –û—Ç–∫—Ä—ã—Ç–∏–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function openSubPage(btnData) {
            tg.HapticFeedback.impactOccurred('medium');
            
            // –ù–∞–ø–æ–ª–Ω—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç
            document.getElementById('sub-page-title').textContent = btnData.title;
            document.getElementById('sub-page-subtitle').textContent = btnData.subtitle;
            
            const container = document.getElementById('sub-page-container');
            container.innerHTML = '';

            (btnData.items || []).forEach(item => {
                const itemEl = document.createElement('div');
                itemEl.className = 'glass-card p-4 flex items-center cursor-pointer';
                itemEl.onclick = () => handleLink(item.link);
                itemEl.innerHTML = `
                    <div class="icon-box text-blue-300 text-xl">${item.icon || 'üìÑ'}</div>
                    <div class="flex-1 text-white font-medium">${item.title}</div>
                    <div class="opacity-30 text-xl">‚Ä∫</div>
                `;
                container.appendChild(itemEl);
            });

            // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
            document.getElementById('main-page').classList.replace('active', 'hidden-left');
            document.getElementById('sub-page').classList.replace('hidden-right', 'active');
            tg.BackButton.show();
        }

        const mainPage = document.getElementById('main-page');
        const subPage = document.getElementById('sub-page');
        const adminPage = document.getElementById('admin-page');

        tg.BackButton.onClick(() => hideSubPage());

        function hideSubPage() {
            tg.HapticFeedback.impactOccurred('light');
            subPage.classList.replace('active', 'hidden-right');
            mainPage.classList.replace('hidden-left', 'active');
            tg.BackButton.hide();
        }

        function handleLink(url) {
            tg.HapticFeedback.impactOccurred('medium');
            if (!url) return;
            if (url.startsWith('https://t.me/')) tg.openTelegramLink(url);
            else tg.openLink(url);
        }

        // --- –õ–û–ì–ò–ö–ê –°–í–ê–ô–ü–ê (–î–õ–Ø SUB-PAGE) ---
        let touchStartX = 0;
        let touchStartY = 0;

        subPage.addEventListener('touchstart', (e) => {
            touchStartX = e.changedTouches[0].screenX;
            touchStartY = e.changedTouches[0].screenY;
        }, { passive: true });

        subPage.addEventListener('touchend', (e) => {
            const touchEndX = e.changedTouches[0].screenX;
            const touchEndY = e.changedTouches[0].screenY;
            const diffX = touchEndX - touchStartX;
            const diffY = Math.abs(touchEndY - touchStartY);
            if (touchStartX < 80 && diffX > 70 && diffY < 50) {
                hideSubPage();
            }
        }, { passive: true });


        // --- –õ–û–ì–ò–ö–ê –ê–î–ú–ò–ù–ö–ò ---
        let tapCount = 0;
        let tapTimer;
        document.getElementById('nav-header').addEventListener('click', () => {
            tapCount++;
            clearTimeout(tapTimer);
            tapTimer = setTimeout(() => tapCount = 0, 1000);
            if (tapCount >= 5) {
                const userId = tg.initDataUnsafe?.user?.id;
                if (userId === ADMIN_ID) openAdmin();
                else {
                    const password = prompt('–ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:');
                    if (password === ADMIN_PASSWORD) openAdmin();
                    else if (password !== null) alert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω');
                }
                tapCount = 0;
            }
        });

        let tempAppData = null;
        let currentEditingIndex = null; // –ò–Ω–¥–µ–∫—Å —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–µ–º–æ–π –∫–Ω–æ–ø–∫–∏

        function openAdmin() {
            tg.HapticFeedback.impactOccurred('heavy');
            tempAppData = JSON.parse(JSON.stringify(appData));
            
            // –ó–∞–≥–æ–ª–æ–≤–∫–∏
            document.getElementById('admin-header-title').value = tempAppData.headerTitle;
            document.getElementById('admin-header-subtitle').value = tempAppData.headerSubtitle;
            
            // –°–±—Ä–æ—Å –≤–∏–¥–∞
            document.getElementById('admin-content-main').classList.remove('hidden');
            document.getElementById('admin-content-sublist').classList.add('hidden');
            
            renderAdminMainMenu();
            adminPage.classList.replace('hidden-bottom', 'active-modal');
        }

        function renderAdminMainMenu() {
            const list = document.getElementById('admin-main-menu-list');
            list.innerHTML = '';
            (tempAppData.mainMenu || []).forEach((btn, index) => {
                const div = document.createElement('div');
                div.className = "guide-item-admin";
                
                // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞
                let modeControlHtml = '';
                if (btn.mode === 'link') {
                    modeControlHtml = `
                        <input type="text" class="admin-input mt-2" value="${btn.directLink || ''}" placeholder="URL —Å—Å—ã–ª–∫–∏" onchange="tempAppData.mainMenu[${index}].directLink = this.value">
                    `;
                } else {
                    modeControlHtml = `
                        <button onclick="editSubList(${index})" class="btn-edit-list">
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ (${(btn.items || []).length} —à—Ç.) ‚Ä∫
                        </button>
                    `;
                }

                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] text-cyan-400">–ö–ù–û–ü–ö–ê ${index + 1}</span>
                        <button onclick="removeMainMenuButton(${index})" class="btn-delete-icon">‚úï</button>
                    </div>
                    
                    <label class="admin-label">–ù–∞–∑–≤–∞–Ω–∏–µ</label>
                    <input type="text" class="admin-input" value="${btn.title}" onchange="tempAppData.mainMenu[${index}].title = this.value">
                    
                    <label class="admin-label">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫ (–°—Ç–∞—Ç—É—Å)</label>
                    <input type="text" class="admin-input" value="${btn.subtitle}" onchange="tempAppData.mainMenu[${index}].subtitle = this.value">

                    <label class="admin-label mt-2">–¢–∏–ø –¥–µ–π—Å—Ç–≤–∏—è</label>
                    <select class="admin-select" onchange="changeBtnMode(${index}, this.value)">
                        <option value="link" ${btn.mode === 'link' ? 'selected' : ''}>–ü—Ä—è–º–∞—è —Å—Å—ã–ª–∫–∞</option>
                        <option value="list" ${btn.mode === 'list' ? 'selected' : ''}>–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —Å–ø–∏—Å–æ–∫</option>
                    </select>
                    
                    ${modeControlHtml}
                `;
                list.appendChild(div);
            });
        }

        function changeBtnMode(index, newMode) {
            tempAppData.mainMenu[index].mode = newMode;
            if (!tempAppData.mainMenu[index].items) tempAppData.mainMenu[index].items = [];
            renderAdminMainMenu();
        }

        function editSubList(index) {
            currentEditingIndex = index;
            document.getElementById('admin-content-main').classList.add('hidden');
            document.getElementById('admin-content-sublist').classList.remove('hidden');
            
            const btnTitle = tempAppData.mainMenu[index].title;
            document.getElementById('admin-sublist-title').textContent = `–°–ø–∏—Å–æ–∫ –¥–ª—è: ${btnTitle}`;
            
            renderSubListItems();
        }

        function renderSubListItems() {
            const list = document.getElementById('admin-sublist-items');
            list.innerHTML = '';
            const items = tempAppData.mainMenu[currentEditingIndex].items || [];
            
            items.forEach((item, itemIndex) => {
                const div = document.createElement('div');
                div.className = "guide-item-admin";
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-[10px] text-gray-500">–ü–£–ù–ö–¢ ${itemIndex + 1}</span>
                        <button onclick="removeSubItem(${itemIndex})" class="btn-delete-icon">‚úï</button>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" class="admin-input w-16 text-center" value="${item.icon}" placeholder="Icon" onchange="updateSubItem(${itemIndex}, 'icon', this.value)">
                        <input type="text" class="admin-input flex-1" value="${item.title}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" onchange="updateSubItem(${itemIndex}, 'title', this.value)">
                    </div>
                    <input type="text" class="admin-input mt-1" value="${item.link}" placeholder="–°—Å—ã–ª–∫–∞" onchange="updateSubItem(${itemIndex}, 'link', this.value)">
                `;
                list.appendChild(div);
            });
        }

        function updateSubItem(itemIndex, field, value) {
            tempAppData.mainMenu[currentEditingIndex].items[itemIndex][field] = value;
        }

        function addNewSubItem() {
            if (!tempAppData.mainMenu[currentEditingIndex].items) tempAppData.mainMenu[currentEditingIndex].items = [];
            tempAppData.mainMenu[currentEditingIndex].items.push({
                title: '–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç',
                link: '',
                icon: 'üîπ'
            });
            renderSubListItems();
        }

        function removeSubItem(itemIndex) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç?')) {
                tempAppData.mainMenu[currentEditingIndex].items.splice(itemIndex, 1);
                renderSubListItems();
            }
        }

        function saveSubList() {
            // –ü—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è, –¥–∞–Ω–Ω—ã–µ —É–∂–µ –≤ tempAppData
            backToMainAdmin();
        }

        function backToMainAdmin() {
            document.getElementById('admin-content-sublist').classList.add('hidden');
            document.getElementById('admin-content-main').classList.remove('hidden');
            currentEditingIndex = null;
            renderAdminMainMenu(); // –û–±–Ω–æ–≤–∏—Ç—å —Å—á–µ—Ç—á–∏–∫–∏ items
        }

        function addNewMainMenuButton() {
            tempAppData.mainMenu.push({
                id: "new",
                title: "–ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞",
                subtitle: "–û–ø–∏—Å–∞–Ω–∏–µ",
                iconContent: '<path d="M12 2v20M2 12h20"></path>',
                iconColor: "text-white",
                mode: "link",
                directLink: "",
                items: []
            });
            renderAdminMainMenu();
        }

        function removeMainMenuButton(index) {
            if(confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∫–Ω–æ–ø–∫—É?')) {
                tempAppData.mainMenu.splice(index, 1);
                renderAdminMainMenu();
            }
        }

        function closeAdmin() {
            adminPage.classList.replace('active-modal', 'hidden-bottom');
            tempAppData = null;
            currentEditingIndex = null;
        }

        async function saveAdminData() {
            if (!db) return alert("–ë–î –Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞.");
            
            tg.HapticFeedback.impactOccurred('medium');
            
            tempAppData.headerTitle = document.getElementById('admin-header-title').value;
            tempAppData.headerSubtitle = document.getElementById('admin-header-subtitle').value;

            try {
                await db.collection('configs').doc(configDocId).set(tempAppData);
                
                const status = document.getElementById('save-status');
                status.style.opacity = '1';
                setTimeout(() => { 
                    status.style.opacity = '0'; 
                    closeAdmin(); 
                }, 1500);
            } catch (e) {
                alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö.");
            }
        }

        initApp();
        tg.ready();
    </script>
</body>
</html>