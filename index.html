<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Navigation</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Telegram WebApp -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-color: #00f2ff;
            --neon-pink: #ff007a;
            --neon-green: #39ff14;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: #050505;
            color: white;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            margin: 0;
            position: fixed;
        }

        .bg-glow {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at 20% 30%, #1a1033 0%, #050505 50%);
        }

        .orb {
            position: absolute;
            border-radius: 50%;
            filter: blur(80px);
            opacity: 0.3;
            animation: float 15s infinite alternate ease-in-out;
        }

        .orb-1 { width: 300px; height: 300px; background: var(--neon-color); top: -80px; right: -40px; }
        .orb-2 { width: 250px; height: 250px; background: var(--neon-pink); bottom: -60px; left: -40px; animation-delay: -3s; }

        @keyframes float {
            0% { transform: translate(0, 0) scale(1); }
            100% { transform: translate(30px, 50px) scale(1.1); }
        }

        .status-container {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #444;
            transition: all 0.5s ease;
        }

        .status-dot.online {
            background: var(--neon-green);
            box-shadow: 0 0 10px var(--neon-green);
            animation: pulse-green 2s infinite;
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }

        .page {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
            padding: 24px 20px calc(40px + env(safe-area-inset-bottom));
            -webkit-overflow-scrolling: touch;
            display: flex;
            flex-direction: column;
        }

        .hidden-left { transform: translateX(-100%); opacity: 0; pointer-events: none; }
        .hidden-right { transform: translateX(100%); opacity: 0; pointer-events: none; }
        .hidden-bottom { transform: translateY(100%); opacity: 0; pointer-events: none; }
        .active { transform: translateX(0); opacity: 1; pointer-events: all; }
        .active-modal { transform: translateY(0); opacity: 1; pointer-events: all; }

        .glass-card {
            background: rgba(255, 255, 255, 0.04);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 22px;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        .glass-card:active {
            transform: scale(0.94);
            border-color: rgba(0, 242, 255, 0.5);
        }

        /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∞–ø–∫–∞ –∞–¥–º–∏–Ω–∫–∏ */
        .admin-header {
            position: sticky;
            top: 0;
            background: #0a0a0f;
            z-index: 110;
            padding: 16px 20px;
            margin: -24px -20px 24px -20px;
            border-bottom: 1px solid rgba(0, 242, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-card {
            background: rgba(10, 10, 15, 0.8);
            border: 1px solid rgba(0, 242, 255, 0.15);
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .admin-section-title {
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            color: var(--neon-color);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-input {
            width: 100%;
            background: rgba(0,0,0,0.4);
            border: 1px solid rgba(255,255,255,0.1);
            color: white;
            padding: 10px 12px;
            border-radius: 10px;
            margin-bottom: 8px;
            font-size: 13px;
        }

        .admin-label {
            font-size: 10px;
            color: #777;
            margin-bottom: 4px;
            display: block;
            text-transform: uppercase;
        }

        .btn-sort-arrow {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .btn-sort-arrow:active { background: var(--neon-color); color: black; }

        .btn-save-cyber {
            background: linear-gradient(135deg, #0066ff, #00f2ff);
            color: white;
            font-weight: 700;
            padding: 14px;
            border-radius: 15px;
            width: 100%;
            text-transform: uppercase;
        }

        .icon-box {
            width: 54px;
            height: 54px;
            background: linear-gradient(135deg, rgba(255,255,255,0.08), rgba(255,255,255,0.02));
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 18px;
            flex-shrink: 0;
        }

        .title-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #a1a1a1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
    </style>
</head>
<body>
    <div class="bg-glow">
        <div class="orb orb-1"></div>
        <div class="orb orb-2"></div>
    </div>

    <div class="status-container">
        <div id="status-dot" class="status-dot online"></div>
    </div>

    <!-- –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù -->
    <div id="main-page" class="page active">
        <header class="mb-10 mt-4 text-center">
            <h1 id="nav-header" class="text-3xl font-bold title-gradient tracking-tight select-none cursor-pointer">–ù–∞–≤–∏–≥–∞—Ü–∏—è</h1>
            <p id="nav-subheader" class="text-gray-500 text-sm mt-2">–¢–≤–æ–π –ø—Ä–æ–≤–æ–¥–Ω–∏–∫ –ø–æ –∫–æ–Ω—Ç–µ–Ω—Ç—É</p>
        </header>

        <div id="main-menu-container" class="grid gap-4"></div>
    </div>

    <!-- –í–ù–£–¢–†–ï–ù–ù–Ø–Ø –°–¢–†–ê–ù–ò–¶–ê -->
    <div id="sub-page" class="page hidden-right">
        <header class="mb-10 mt-4 text-center">
            <h1 id="sub-page-title" class="text-3xl font-bold title-gradient tracking-tight">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h1>
            <p id="sub-page-subtitle" class="text-gray-500 text-sm mt-2">–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞</p>
        </header>
        <div id="sub-page-container" class="grid gap-4"></div>
    </div>

    <!-- –ê–î–ú–ò–ù–ö–ê -->
    <div id="admin-page" class="page hidden-bottom" style="background: #050508; z-index: 1000;">
        <div class="admin-header">
            <div>
                <h2 class="text-lg font-bold text-white uppercase leading-none">Terminal</h2>
                <span class="text-[9px] text-cyan-400 font-mono">ROOT_ACCESS_GRANTED</span>
            </div>
            <button onclick="closeAdmin()" class="bg-white/5 w-8 h-8 rounded-full flex items-center justify-center">‚úï</button>
        </div>

        <div id="admin-main-view">
            <div class="admin-card">
                <div class="admin-section-title">–ó–∞–≥–æ–ª–æ–≤–∫–∏</div>
                <label class="admin-label">–ó–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="admin-input-h1" class="admin-input">
                <label class="admin-label">–ü–æ–¥–∑–∞–≥–æ–ª–æ–≤–æ–∫</label>
                <input type="text" id="admin-input-p" class="admin-input">
            </div>

            <div class="admin-card">
                <div class="admin-section-title">–ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é</div>
                <div id="admin-list-main" class="space-y-4"></div>
                <button onclick="addMainBtn()" class="w-full border border-dashed border-cyan-500/50 p-3 rounded-xl text-cyan-400 text-sm mt-4">+ –î–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É</button>
            </div>
            
            <button onclick="saveAll()" class="btn-save-cyber mb-10">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
        </div>

        <div id="admin-sub-view" class="hidden">
            <button onclick="backToMainAdmin()" class="text-cyan-400 text-xs mb-4 flex items-center gap-1">‚Üê –ù–∞–∑–∞–¥ –≤ –∫–æ—Ä–µ–Ω—å</button>
            <div class="admin-card">
                <div id="admin-sub-title" class="admin-section-title">–°–ø–∏—Å–æ–∫</div>
                <div id="admin-list-sub" class="space-y-4"></div>
                <button onclick="addSubBtn()" class="w-full border border-dashed border-pink-500/50 p-3 rounded-xl text-pink-400 text-sm mt-4">+ –î–æ–±–∞–≤–∏—Ç—å –ø—É–Ω–∫—Ç</button>
            </div>
            <button onclick="backToMainAdmin()" class="btn-save-cyber mb-10">–ì–æ—Ç–æ–≤–æ</button>
        </div>
        
        <div id="save-status" class="fixed bottom-10 left-0 right-0 text-center text-cyan-400 font-mono text-[10px] opacity-0 transition-opacity">SYNC_COMPLETE...</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const ADMIN_PASSWORD = "cyber_admin_secure_99";
        const configDocId = "main_nav_v4_pro";
        
        const firebaseConfig = {
            apiKey: "AIzaSyCiYBslwEecbyuMyW5J05nvTs_sXLlurR4",
            authDomain: "tg-menu.firebaseapp.com",
            projectId: "tg-menu",
            storageBucket: "tg-menu.firebasestorage.app",
            messagingSenderId: "754545603793",
            appId: "1:754545603793:web:a466fd9b21a298a69d41f0"
        };

        let db, auth, appData = { headerTitle: "–ù–∞–≤–∏–≥–∞—Ü–∏—è", headerSubtitle: "–ó–∞–≥—Ä—É–∑–∫–∞...", mainMenu: [] };
        let tempAppData = null;
        let activeSubIdx = null;

        // –õ–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞
        let tapCount = 0;
        let tapTimer = null;
        document.getElementById('nav-header').addEventListener('click', () => {
            tapCount++;
            clearTimeout(tapTimer);
            tapTimer = setTimeout(() => { tapCount = 0; }, 500);
            if (tapCount >= 5) {
                tapCount = 0;
                const p = prompt("ACCESS_KEY:");
                if (p === ADMIN_PASSWORD) openAdmin();
            }
        });

        async function initApp() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                auth = firebase.auth();
                await auth.signInAnonymously();
                
                db.collection('configs').doc(configDocId).onSnapshot(doc => {
                    if (doc.exists) {
                        appData = doc.data();
                        renderUI();
                    } else {
                        db.collection('configs').doc(configDocId).set(appData);
                    }
                });
            } catch(e) { console.error(e); }
        }

        function renderUI() {
            document.getElementById('nav-header').textContent = appData.headerTitle || "–ù–∞–≤–∏–≥–∞—Ü–∏—è";
            document.getElementById('nav-subheader').textContent = appData.headerSubtitle || "";
            const cont = document.getElementById('main-menu-container');
            cont.innerHTML = '';
            (appData.mainMenu || []).forEach(btn => {
                const el = document.createElement('div');
                el.className = 'glass-card p-4 flex items-center cursor-pointer';
                el.onclick = () => btn.mode === 'list' ? openSub(btn) : tg.openLink(btn.directLink);
                el.innerHTML = `
                    <div class="icon-box">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6 text-cyan-400">
                            ${btn.iconContent || '<circle cx="12" cy="12" r="10"/>'}
                        </svg>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-semibold text-white">${btn.title}</h3>
                        <p class="text-xs text-white/50">${btn.subtitle}</p>
                    </div>
                    <div class="opacity-30">‚Ä∫</div>
                `;
                cont.appendChild(el);
            });
        }

        function openSub(btn) {
            document.getElementById('sub-page-title').textContent = btn.title;
            document.getElementById('sub-page-subtitle').textContent = btn.subtitle;
            const cont = document.getElementById('sub-page-container');
            cont.innerHTML = '';
            (btn.items || []).forEach(item => {
                const el = document.createElement('div');
                el.className = 'glass-card p-4 flex items-center cursor-pointer';
                el.onclick = () => tg.openLink(item.link);
                el.innerHTML = `<div class="mr-4 text-xl">${item.icon}</div><div class="flex-1">${item.title}</div><div class="opacity-20">‚Ä∫</div>`;
                cont.appendChild(el);
            });
            document.getElementById('main-page').classList.replace('active', 'hidden-left');
            document.getElementById('sub-page').classList.replace('hidden-right', 'active');
            tg.BackButton.show();
            tg.BackButton.onClick(() => {
                document.getElementById('sub-page').classList.replace('active', 'hidden-right');
                document.getElementById('main-page').classList.replace('hidden-left', 'active');
                tg.BackButton.hide();
            });
        }

        // –ê–î–ú–ò–ù–ö–ê –§–£–ù–ö–¶–ò–ò
        function openAdmin() {
            tempAppData = JSON.parse(JSON.stringify(appData));
            document.getElementById('admin-input-h1').value = tempAppData.headerTitle;
            document.getElementById('admin-input-p').value = tempAppData.headerSubtitle;
            renderAdminMain();
            document.getElementById('admin-page').classList.replace('hidden-bottom', 'active-modal');
        }

        function renderAdminMain() {
            const list = document.getElementById('admin-list-main');
            list.innerHTML = '';
            (tempAppData.mainMenu || []).forEach((btn, i) => {
                const div = document.createElement('div');
                div.className = 'bg-white/5 p-3 rounded-xl border border-white/10 relative';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex gap-1">
                            <button onclick="moveMain(${i}, -1)" class="btn-sort-arrow">‚ñ≤</button>
                            <button onclick="moveMain(${i}, 1)" class="btn-sort-arrow">‚ñº</button>
                        </div>
                        <button onclick="delMain(${i})" class="text-red-500 text-xs">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                    <input type="text" class="admin-input" value="${btn.title}" oninput="tempAppData.mainMenu[${i}].title=this.value">
                    <input type="text" class="admin-input" value="${btn.subtitle}" oninput="tempAppData.mainMenu[${i}].subtitle=this.value">
                    <div class="flex gap-2 mt-2">
                        <button onclick="editSubAdmin(${i})" class="flex-1 bg-cyan-500/10 text-cyan-400 py-2 rounded text-[10px] uppercase font-bold">–°–ø–∏—Å–æ–∫ (${(btn.items||[]).length})</button>
                        <input type="text" class="admin-input mb-0 flex-1" value="${btn.directLink || ''}" placeholder="–°—Å—ã–ª–∫–∞" oninput="tempAppData.mainMenu[${i}].directLink=this.value">
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function moveMain(idx, dir) {
            const newIdx = idx + dir;
            if (newIdx < 0 || newIdx >= tempAppData.mainMenu.length) return;
            const [item] = tempAppData.mainMenu.splice(idx, 1);
            tempAppData.mainMenu.splice(newIdx, 0, item);
            renderAdminMain();
        }

        function delMain(i) { if(confirm('–£–¥–∞–ª–∏—Ç—å –∫–Ω–æ–ø–∫—É?')) { tempAppData.mainMenu.splice(i,1); renderAdminMain(); } }
        function addMainBtn() { 
            tempAppData.mainMenu.push({title: '–ù–æ–≤–∞—è –∫–Ω–æ–ø–∫–∞', subtitle: '–û–ø–∏—Å–∞–Ω–∏–µ', mode: 'link', items: [], iconContent: '<circle cx="12" cy="12" r="10"/>'});
            renderAdminMain(); 
        }

        function editSubAdmin(i) {
            activeSubIdx = i;
            document.getElementById('admin-main-view').classList.add('hidden');
            document.getElementById('admin-sub-view').classList.remove('hidden');
            document.getElementById('admin-sub-title').textContent = "–í–ª–æ–∂–µ–Ω–Ω—ã–π: " + tempAppData.mainMenu[i].title;
            renderAdminSub();
        }

        function renderAdminSub() {
            const list = document.getElementById('admin-list-sub');
            list.innerHTML = '';
            const items = tempAppData.mainMenu[activeSubIdx].items || [];
            items.forEach((item, i) => {
                const div = document.createElement('div');
                div.className = 'bg-white/5 p-3 rounded-xl border border-white/10';
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-2">
                        <div class="flex gap-1">
                            <button onclick="moveSub(${i}, -1)" class="btn-sort-arrow">‚ñ≤</button>
                            <button onclick="moveSub(${i}, 1)" class="btn-sort-arrow">‚ñº</button>
                        </div>
                        <button onclick="delSub(${i})" class="text-red-400 text-xs">‚úï</button>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" class="admin-input w-12" value="${item.icon}" oninput="tempAppData.mainMenu[${activeSubIdx}].items[${i}].icon=this.value">
                        <input type="text" class="admin-input flex-1" value="${item.title}" oninput="tempAppData.mainMenu[${activeSubIdx}].items[${i}].title=this.value">
                    </div>
                    <input type="text" class="admin-input" value="${item.link}" placeholder="URL" oninput="tempAppData.mainMenu[${activeSubIdx}].items[${i}].link=this.value">
                `;
                list.appendChild(div);
            });
        }

        function moveSub(idx, dir) {
            const items = tempAppData.mainMenu[activeSubIdx].items;
            const newIdx = idx + dir;
            if (newIdx < 0 || newIdx >= items.length) return;
            const [item] = items.splice(idx, 1);
            items.splice(newIdx, 0, item);
            renderAdminSub();
        }

        function addSubBtn() {
            if(!tempAppData.mainMenu[activeSubIdx].items) tempAppData.mainMenu[activeSubIdx].items = [];
            tempAppData.mainMenu[activeSubIdx].items.push({title:'–ù–æ–≤—ã–π –ø—É–Ω–∫—Ç', icon:'üìÑ', link:''});
            tempAppData.mainMenu[activeSubIdx].mode = 'list';
            renderAdminSub();
        }

        function delSub(i) { tempAppData.mainMenu[activeSubIdx].items.splice(i,1); renderAdminSub(); }

        function backToMainAdmin() {
            document.getElementById('admin-sub-view').classList.add('hidden');
            document.getElementById('admin-main-view').classList.remove('hidden');
            renderAdminMain();
        }

        async function saveAll() {
            tempAppData.headerTitle = document.getElementById('admin-input-h1').value;
            tempAppData.headerSubtitle = document.getElementById('admin-input-p').value;
            try {
                await db.collection('configs').doc(configDocId).set(tempAppData);
                document.getElementById('save-status').style.opacity = '1';
                setTimeout(() => { 
                    document.getElementById('save-status').style.opacity = '0';
                    closeAdmin();
                }, 1500);
            } catch(e) { alert("Error saving data"); }
        }

        function closeAdmin() { 
            document.getElementById('admin-page').classList.replace('active-modal', 'hidden-bottom'); 
            tempAppData = null;
        }

        initApp();
        tg.ready();
    </script>
</body>
</html>